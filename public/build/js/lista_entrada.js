const entradas={fechaEntrada:"",fechaRecepcion:"",subtotal:"",folio:"",total:"",totaliva:"",totaldescuento:"",estatus:"",Usuario:"",Proveedor:[]};function iniciarApp(){consultarAPI()}async function consultarAPI(){try{const a="/api/entradas",t="/api/proveedor",o="/api/usuario",e=await fetch(a),d=await fetch(t),i=await fetch(o),c=await e.json(),n=await d.json(),r=await i.json();mostrarTabla(c),mostrarProveedor(n),mostrarUsuario(r)}catch(a){console.log(a)}}function mostrarProveedor(a){document.querySelector("#proveedor").innerHTML="",a.forEach(a=>{const{id:t,nombre_comercial:o,nombre_fiscal:e,rfc:d,domicilio:i,telefono:c,correo:n}=a,r=document.createElement("OPTION");r.textContent=d,r.value=t,document.querySelector("#proveedor").appendChild(r)}),document.querySelector("#proveedor").addEventListener("change",(function(){const t=this.value;seleccionarProveedor(a.find(a=>a.id===t))}))}function seleccionarProveedor(a){const{Proveedor:t}=entradas;entradas.Proveedor={...t,resultado:a};a.nombre_comercial}function mostrarUsuario(a){document.querySelector("#usuario").innerHTML="",a.forEach(a=>{const{id:t,nombre:o,apellidos:e,email:d,admin:i,confirmado:c,token:n,password:r}=a,l=document.createElement("OPTION");l.textContent=o+" "+e,l.value=t,document.querySelector("#usuario").appendChild(l)}),document.querySelector("#usuario").addEventListener("change",(function(){const t=this.value;seleccionarUsuario(a.find(a=>a.id===t))}))}function seleccionarUsuario(a){const t=a.id;console.log(t)}function mostrarTabla(a){$("#myTable").DataTable().clear().destroy();let t="";a.forEach(a=>{a.id=null==a.id?"":a.id,a.id_proveedor=null==a.id_proveedor?"":a.id_proveedor,a.nombre_comercial=null==a.nombre_comercial?"":a.nombre_comercial,a.id_usuario=null==a.id_usuario?"":a.id_usuario,a.usuario=null==a.usuario?"":a.usuario,a.fecha_entrada=null==a.fecha_entrada?"":a.fecha_entrada,a.fecha_recepcion=null==a.fecha_recepcion?"":a.fecha_recepcion,a.subtotal=null==a.subtotal?"":a.subtotal,a.folio=null==a.folio?"":a.folio,a.total=null==a.total?"":a.total,a.total_iva=null==a.total_iva?"":a.total_iva,a.total_descuento=null==a.total_descuento?"":a.total_descuento,a.estatus=null==a.estatus?"":a.estatus;var o=` data-id="${a.id}"   \n                            data-id_proveedor="${a.id_proveedor}"\n                            data-nombre_comercial="${a.nombre_comercial}"\n                            data-id_usuario="${a.id_usuario}"\n                            data-usuario="${a.usuario}"\n                            data-fecha_entrada="${a.fecha_entrada}"\n                            data-fecha_recepcion="${a.fecha_recepcion}"\n                            data-subtotal="${a.subtotal}"\n                            data-folio="${a.folio}"\n                            data-total="${a.total}"\n                            data-total_iva="${a.total_iva}"\n                            data-total_descuento="${a.total_descuento}"\n                            data-estatus="${a.estatus}"\n                            `;t+="  <tr>",t+="      <td>",t+='          <div class="dropdown">',t+='             <button class="btn btn-primary btn-sm dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">',t+='              \tAcciones <span class="caret"></span>',t+="             </button>",t+='             <ul class="dropdown-menu">',t+=`               <li><a href="#" class="dropdown-item" id="button_accion" data-opcion="ver" ${o}>Ver</a></li>`,t+=`\t\t\t\t        <li><a href="#" class="dropdown-item" id="button_accion" data-opcion="editar" ${o}>Editar</a></li>`,t+='               <li><a href="#" class="dropdown-item" id="button_accion" data-opcion="eliminar" data-id="'+a.id+'">Eliminar</a></li>',t+="             </ul>",t+="           </div>",t+="      </td>",t+=`      <td>${a.nombre_comercial}</td>`,t+=`      <td>${a.fecha_entrada}</td>`,t+=`      <td>${a.fecha_recepcion}</td>`,t+=`      <td>${a.folio}</td>`,t+=`      <td>${a.estatus}</td>`,t+="  </tr>"}),$("#myTable tbody").html(t),$("#myTable").DataTable()}function get_tag(a){return{id:$(a).data("id"),id_proveedor:$(a).data("id_proveedor"),nombre_comercial:$(a).data("nombre_comercial"),id_usuario:$(a).data("id_usuario"),usuario:$(a).data("usuario"),fecha_entrada:$(a).data("fecha_entrada"),fecha_recepcion:$(a).data("fecha_recepcion"),subtotal:$(a).data("subtotal"),folio:$(a).data("folio"),total:$(a).data("total"),total_iva:$(a).data("total_iva"),total_descuento:$(a).data("total_descuento"),estatus:$(a).data("estatus")}}document.addEventListener("DOMContentLoaded",(function(){iniciarApp()}));const form=document.querySelector("#form_entrada_productos");async function actualizar_fac_rem(a){Proveedor=$("#proveedor").val(),Usuario=$("#usuario").val(),fechaEntrada=$("#fecha_entrada").val(),fechaRecepcion=$("#fecha_recepcion").val(),folio=$("#folio").val(),subtotal=$("#subtotal").val(),total=$("#total").val(),totaliva=$("#total_iva").val(),totaldescuento=$("#total_descuento").val(),estatus=$("#estatus").val();const t=await fetch("/api/actualizar-entrada",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a,id_proveedor:Proveedor,id_usuario:Usuario,fecha_entrada:fechaEntrada,fecha_recepcion:fechaRecepcion,subtotal:subtotal,folio:folio,total:total,total_iva:totaliva,total_descuento:totaldescuento,estatus:estatus})});!0===await t.json()?($("#modalSignin").modal("hide"),$.confirm({theme:"black",title:"Exito!",content:"Los datos generales de la Fcatura/Remisión se han actualizado correctamente",type:"blue",typeAnimated:!0,buttons:{tryAgain:{text:"OK",btnClass:"btn-blue",close:function(){}}}}),consultarAPI()):$.confirm({theme:"black",title:"Error!",content:"Algo salió mal, intentalo mas tarde",type:"red",typeAnimated:!0,buttons:{tryAgain:{text:"OK",btnClass:"btn-red",close:function(){}}}})}async function eliminar_fac_rem(a){const t=await fetch("/api/eliminar-entrada",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a})}),o=await t.json();$("#modalSheet").modal("hide"),!0===o?($.confirm({theme:"black",title:"Exito!",content:"La Factura/Remisión se ha eliminado correctamente",type:"blue",typeAnimated:!0,buttons:{tryAgain:{text:"OK",btnClass:"btn-blue",close:function(){}}}}),consultarAPI()):$.confirm({theme:"black",title:"Error!",content:"Algo salió mal, intentalo mas tarde.",type:"red",typeAnimated:!0,buttons:{tryAgain:{text:"OK",btnClass:"btn-red",close:function(){}}}})}async function mostrarTablaDetalle(a){try{const t="/api/entrada_productos?id_entrada="+a,o=await fetch(t),e=await o.json();$("#myTableDetail").DataTable().clear().destroy();let d="";e.forEach(a=>{a.id=null==a.id?"":a.id,a.id_producto=null==a.id_producto?"":a.id_producto,a.nombre_producto=null==a.nombre_producto?"":a.nombre_producto,a.presentacion=null==a.presentacion?"":a.presentacion,a.descripcion=null==a.descripcion?"":a.descripcion,a.marca=null==a.marca?"":a.marca,a.fecha_caducidad=null==a.fecha_caducidad?"":a.fecha_caducidad,a.cantidad=null==a.cantidad?"":a.cantidad,a.precio_compra=null==a.precio_compra?"":a.precio_compra,a.importe_sin_descuento=null==a.importe_sin_descuento?"":a.importe_sin_descuento,a.descuento=null==a.descuento?"":a.descuento,a.importe_con_descuento=null==a.importe_con_descuento?"":a.importe_con_descuento,a.iva=null==a.iva?"":a.iva,a.importe_c_iva=null==a.importe_c_iva?"":a.importe_c_iva,a.precio_sugerido=null==a.precio_sugerido?"":a.precio_sugerido;var t=` data-id="${a.id}"   \n                                data-id_producto="${a.id_producto}"\n                                data-nombre_producto="${a.nombre_producto}"\n                                data-presentacion="${a.presentacion}"\n                                data-descripcion="${a.descripcion}"\n                                data-marca="${a.marca}"\n                                data-fecha_caducidad="${a.fecha_caducidad}"\n                                data-cantidad="${a.cantidad}"\n                                data-precio_compra="${a.precio_compra}"\n                                data-importe_sin_descuento="${a.importe_sin_descuento}"\n                                data-descuento="${a.descuento}"\n                                data-importe_con_descuento="${a.importe_con_descuento}"\n                                data-iva="${a.iva}"\n                                data-importe_c_iva="${a.importe_c_iva}"\n                                data-precio_sugerido="${a.precio_sugerido}"\n                                `;d+="  <tr>",d+="      <td>",d+='          <div class="dropdown">',d+='             <button class="btn btn-primary btn-sm dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">',d+='              \tAcciones <span class="caret"></span>',d+="             </button>",d+='             <ul class="dropdown-menu">',d+=`               <li><a href="#" class="dropdown-item" id="button_accion_producto" data-opcion="ver_producto" ${t}>Ver</a></li>`,d+="             </ul>",d+="           </div>",d+="      </td>",d+=`      <td>${a.nombre_producto}</td>`,d+=`      <td>${a.presentacion}</td>`,d+=`      <td>${a.descripcion}</td>`,d+=`      <td>${a.marca}</td>`,d+=`      <td>${a.fecha_caducidad}</td>`,d+="  </tr>"}),$("#myTableDetail tbody").html(d),$("#myTableDetail").DataTable()}catch(a){console.log(a)}}function get_tag_detail(a){return{id:$(a).data("id"),id_producto:$(a).data("id_producto"),nombre_producto:$(a).data("nombre_producto"),presentacion:$(a).data("presentacion"),descripcion:$(a).data("descripcion"),marca:$(a).data("marca"),fecha_caducidad:$(a).data("fecha_caducidad"),cantidad:$(a).data("cantidad"),precio_compra:$(a).data("precio_compra"),importe_sin_descuento:$(a).data("importe_sin_descuento"),descuento:$(a).data("descuento"),importe_con_descuento:$(a).data("importe_con_descuento"),iva:$(a).data("iva"),importe_c_iva:$(a).data("importe_c_iva"),precio_sugerido:$(a).data("precio_sugerido")}}$(document).on("click","#button_accion",(function(){var a=$(this).data("opcion"),t=get_tag(this),o=t.id,e=t.id_proveedor,d=(t.nombre_comercial,t.id_usuario),i=(t.usuario,t.fecha_entrada),c=t.fecha_recepcion,n=t.subtotal,r=t.folio,l=t.total,s=t.total_iva,u=t.total_descuento,p=t.estatus;switch(a){case"editar":$("#proveedor").val(e),$("#usuario").val(d),$("#fecha_entrada").val(i),$("#fecha_recepcion").val(c),$("#folio").val(r),$("#subtotal").val(n),$("#subtotal").prop("disabled",!0),$("#total").val(l),$("#total").prop("disabled",!0),$("#total_iva").val(s),$("#total_iva").prop("disabled",!0),$("#total_descuento").val(u),$("#total_descuento").prop("disabled",!0),$("#estatus").val(p),$("#modal-title").text("Actualizar Factura/Remisión"),$("#modal_action_button").text("Actualizar"),$("#modal_action_button").data("id",t.id),$("#div_table").hide(),$("#modalSignin").modal("show");break;case"ver":$("#proveedor").val(e),$("#proveedor").prop("disabled",!0),$("#usuario").val(d),$("#usuario").prop("disabled",!0),$("#fecha_entrada").val(i),$("#fecha_entrada").prop("disabled",!0),$("#fecha_recepcion").val(c),$("#fecha_recepcion").prop("disabled",!0),$("#folio").val(r),$("#folio").prop("disabled",!0),$("#subtotal").val("$"+n),$("#subtotal").prop("disabled",!0),$("#total").val("$"+l),$("#total").prop("disabled",!0),$("#total_iva").val("$"+s),$("#total_iva").prop("disabled",!0),$("#total_descuento").val("$"+u),$("#total_descuento").prop("disabled",!0),$("#estatus").val(p),$("#estatus").prop("disabled",!0),$("#modal-title").text("Ver Factura/Remisión"),$("#modal_action_button").hide(),mostrarTablaDetalle(o),$("#div_table").show(),$("#modalSignin").modal("show");break;case"eliminar":$("#modal_action_button").data("id",o),$("#modal_action_button").data("source",a),$("#modal-title-sheet").text("Eliminar Factura/Remisión"),$("#modalSheet").modal("show")}})),$("#modalSignin").on("hidden.bs.modal",(function(){$("#proveedor").prop("disabled",!1),$("#usuario").prop("disabled",!1),$("#fecha_recepcion").prop("disabled",!1),$("#folio").prop("disabled",!1),$("#estatus").prop("disabled",!1),$("#modal_action_button").show(),form.classList.remove("was-validated")})),$(document).on("click","#modal_action_button",(function(a){var t=$(this).text(),o=$("#modal_action_button").data("id"),e=$("#modal_action_button").data("source");const d=document.querySelector(".needs-validation");switch(t){case"Actualizar":if(!d.checkValidity())return a.preventDefault(),a.stopPropagation(),void d.classList.add("was-validated");actualizar_fac_rem(o);break;case"Eliminar":"eliminar"===e?eliminar_fac_rem(o):"eliminar_producto"===e&&console.log("Eliminar producto")}})),$(document).on("click","#button_accion_producto",(function(){var a=$(this).data("opcion"),t=get_tag_detail(this),o=t.id,e=t.id_producto,d=t.presentacion,i=t.descripcion,c=t.marca,n=t.fecha_caducidad,r=t.cantidad,l=t.precio_compra,s=t.importe_sin_descuento,u=t.descuento,p=t.importe_con_descuento,_=t.iva,m=t.importe_c_iva,b=t.precio_sugerido;switch(a){case"editar_producto":$("#modal-title-producto").text("Actualizar Producto"),$("#modal_action_button_producto").text("Actualizar"),$("#modal_action_button_producto").data("id",t.id),$("#modalProducto").modal("show");break;case"ver_producto":$("#producto").val(e),$("#producto").prop("disabled",!0),$("#presentacion").val(d),$("#presentacion").prop("disabled",!0),$("#descripcion").val(i),$("#descripcion").prop("disabled",!0),$("#marca").val(c),$("#marca").prop("disabled",!0),$("#fecha_caducidad").val(n),$("#fecha_caducidad").prop("disabled",!0),$("#cantidad").val(r),$("#cantidad").prop("disabled",!0),$("#precio_compra").val("$"+l),$("#precio_compra").prop("disabled",!0),$("#sub").val("$"+s),$("#sub").prop("disabled",!0),$("#descuento").val("$"+u),$("#descuento").prop("disabled",!0),$("#importe_con_descuento").val("$"+p),$("#importe_con_descuento").prop("disabled",!0),$("#iva").val(_),$("#iva").prop("disabled",!0),$("#importe_c_iva").val("$"+m),$("#importe_c_iva").prop("disabled",!0),$("#precio_sugerido").val("$"+b),$("#precio_sugerido").prop("disabled",!0),$("#modal-title-producto").text("Ver Producto"),$("#modal_action_button_producto").hide(),$("#modalProducto").modal("show");break;case"eliminar_producto":$("#modal_action_button").data("id",o),$("#modal_action_button").data("source",a),$("#modal-title-sheet").text("Eliminar Producto"),$("#modalSheet").modal("show")}})),$(document).on("click","#modal_action_button_producto",(function(a){var t=$(this).text();$("#modal_action_button_producto").data("id"),$("#modal_action_button_producto").data("source");const o=document.querySelector(".needs-validation");switch(t){case"Actualizar":if(!o.checkValidity())return a.preventDefault(),a.stopPropagation(),void o.classList.add("was-validated")}}));