const productos={nombre:"",codigo:"",presentacion:"",Marca:[],Categoria:[],Tipo:[]};function iniciarApp(){consultarAPI()}async function consultarAPI(){try{const a=location.origin+"/api/categoria",o=location.origin+"/api/marca",t=location.origin+"/api/producto_tipo",i=location.origin+"/api/productos",n=await fetch(a),e=await fetch(o),r=await fetch(t),c=await fetch(i),d=await n.json(),l=await e.json(),s=await r.json(),p=await c.json();mostrarMarca(l),mostrarCategoria(d),mostrarTipo(s),mostrarTabla(p)}catch(a){console.log(a)}}function mostrarTabla(a){$("#myTable").DataTable().clear().destroy();let o="";a.forEach(a=>{a.id=null==a.id?"":a.id,a.nombre=null==a.nombre?"":a.nombre,a.id_marca=null==a.id_marca?"":a.id_marca,a.Marca=null==a.Marca?"":a.Marca,a.id_categoria=null==a.id_categoria?"":a.id_categoria,a.Categoria=null==a.Categoria?"":a.Categoria,a.id_producto_tipo=null==a.id_producto_tipo?"":a.id_producto_tipo,a.Tipo=null==a.Tipo?"":a.Tipo,a.codigo_barras=null==a.codigo_barras?"":a.codigo_barras,a.presentacion=null==a.presentacion?"":a.presentacion;var t=`             data-id="${a.id}"   \n                                    data-nombre="${a.nombre}"\n                                    data-id_marca="${a.id_marca}"\n                                    data-Marca="${a.Marca}"\n                                    data-id_categoria="${a.id_categoria}"\n                                    data-Categoria="${a.Categoria}"\n                                    data-id_producto_tipo="${a.id_producto_tipo}"\n                                    data-Tipo="${a.Tipo}"\n                                    data-codigo_barras="${a.codigo_barras}"\n                                    data-presentacion="${a.presentacion}"`;o+="  <tr>",o+="      <td>",o+='          <div class="dropdown">',o+='             <button class="btn btn-primary btn-sm dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">',o+='              \tAcciones <span class="caret"></span>',o+="             </button>",o+='             <ul class="dropdown-menu">',o+=`               <li><a href="#" class="dropdown-item" id="button_accion" data-opcion="ver" ${t}>Ver</a></li>`,o+=`\t\t\t\t        <li><a href="#" class="dropdown-item" id="button_accion" data-opcion="editar" ${t}>Editar</a></li>`,o+='               <li><a href="#" class="dropdown-item" id="button_accion" data-opcion="eliminar" data-id="'+a.id+'">Eliminar</a></li>',o+="             </ul>",o+="           </div>",o+="      </td>",o+=`      <td>${a.nombre}</td>`,o+=`      <td>${a.Marca}</td>`,o+=`      <td>${a.Categoria}</td>`,o+=`      <td>${a.Tipo}</td>`,o+=`      <td>${a.presentacion}</td>`,o+="  </tr>"}),$("#myTable tbody").html(o),$("#myTable").DataTable()}function get_tag(a){return{id:$(a).data("id"),nombre:$(a).data("nombre"),id_marca:$(a).data("id_marca"),Marca:$(a).data("Marca"),id_categoria:$(a).data("id_categoria"),Categoria:$(a).data("Categoria"),id_producto_tipo:$(a).data("id_producto_tipo"),Tipo:$(a).data("Tipo"),codigo_barras:$(a).data("codigo_barras"),presentacion:$(a).data("presentacion")}}function mostrarCategoria(a){a.forEach(a=>{const{id:o,descripcion:t}=a,i=$("<option>").text(t).data("id",o).val(o);$("#categoria").append(i)}),$("#categoria").on("change",(function(){const o=this.value;seleccionarCategoria(a.find(a=>a.id===o))}))}function seleccionarCategoria(a){const{Categoria:o}=productos;productos.Categoria={...o,resultado:a},console.log(productos.Categoria)}function mostrarMarca(a){a.forEach(a=>{const{id:o,descripcion:t}=a,i=$("<option>").text(t).data("id",o).val(o);$("#marca").append(i)}),$("#marca").on("change",(function(){const o=this.value;seleccionarMarca(a.find(a=>a.id===o))}))}function seleccionarMarca(a){const{Marca:o}=productos;productos.Marca={...o,resultado:a},console.log(productos.Marca)}function mostrarTipo(a){a.forEach(a=>{const{id:o,descripcion:t}=a,i=$("<option>").text(t).data("id",o).val(o);$("#tipo_medida").append(i)}),$("#tipo_medida").on("change",(function(){const o=this.value;seleccionarTipo(a.find(a=>a.id===o))}))}function seleccionarTipo(a){const{Tipo:o}=productos;productos.Tipo={...o,resultado:a},console.log(productos.Tipo)}document.addEventListener("DOMContentLoaded",(function(){iniciarApp()})),$(document).on("blur","#nombre",(function(){const a=$("#nombre").val();productos.nombre=a})),$(document).on("blur","#codigo",(function(){const a=$("#codigo").val();productos.codigo=a})),$(document).on("blur","#presentacion",(function(){const a=$("#presentacion").val();productos.presentacion=a}));const form=document.querySelector("#form_producto");function limpiarFormulario(a){a.querySelectorAll("input, select").forEach(a=>{a.value=""})}async function eliminar_producto(a){const o=location.origin+"/api/eliminar-producto",t=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a})});!0===await t.json()?($("#modalSheet").modal("hide"),$.confirm({theme:"black",title:"Exito!",content:"Producto eliminado correctamente",type:"blue",typeAnimated:!0,buttons:{tryAgain:{text:"OK",btnClass:"btn-blue",close:function(){}}}}),consultarAPI()):$.confirm({theme:"black",title:"Error!",content:"Algo salió mal, intentalo mas tarde.",type:"red",typeAnimated:!0,buttons:{tryAgain:{text:"OK",btnClass:"btn-red",close:function(){}}}})}async function actualizar_producto(a){const o=location.origin+"/api/actualizar_producto";nombre=$("#nombre").val(),codigo=$("#codigo").val(),presentacion=$("#presentacion").val(),Marca=$("#marca").val(),Categoria=$("#categoria").val(),Tipo=$("#tipo_medida").val();const t=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a,id_marca:Marca,id_categoria:Categoria,id_producto_tipo:Tipo,nombre:nombre,codigo_barras:codigo,presentacion:presentacion})});!0===await t.json()?($("#modalSignin").modal("hide"),$.confirm({theme:"black",title:"Exito!",content:"Producto actualizado correctamente",type:"blue",typeAnimated:!0,buttons:{tryAgain:{text:"OK",btnClass:"btn-blue",close:function(){}}}}),consultarAPI()):$.confirm({theme:"black",title:"Error!",content:"Algo salió mal, intentalo mas tarde",type:"red",typeAnimated:!0,buttons:{tryAgain:{text:"OK",btnClass:"btn-red",close:function(){}}}})}async function crear_producto(){const{nombre:a,codigo:o,presentacion:t,Marca:i,Categoria:n,Tipo:e}=productos,r=i.resultado.id,c=n.resultado.id,d=e.resultado.id,l=new FormData;l.append("id_marca",r),l.append("id_categoria",c),l.append("id_producto_tipo",d),l.append("nombre",a),l.append("codigo_barras",o),l.append("presentacion",t);const s=location.origin+"/api/crear-producto",p=await fetch(s,{method:"POST",body:l}),u=await p.json();$("#modalSignin").modal("hide"),!0===u.resultado?($.confirm({theme:"black",title:"Exito!",content:"Producto agregado correctamente",type:"blue",typeAnimated:!0,buttons:{tryAgain:{text:"OK",btnClass:"btn-blue",close:function(){}}}}),limpiarFormulario(form),consultarAPI()):$.confirm({theme:"black",title:"Error!",content:"Algo salió mal, intentalo mas tarde",type:"red",typeAnimated:!0,buttons:{tryAgain:{text:"OK",btnClass:"btn-red",close:function(){}}}})}$(document).on("click","#button_accion",(function(){var a=$(this).data("opcion"),o=get_tag(this),t=o.id,i=o.nombre,n=o.id_categoria,e=o.id_marca,r=o.id_producto_tipo,c=o.codigo_barras,d=o.presentacion;switch(a){case"crear":$("#modal-title").text("Crear producto"),$("#modal_action_button").text("Crear"),$("#modalSignin").modal("show"),limpiarFormulario(form);break;case"editar":$("#nombre").val(i),$("#categoria").val(n).trigger("change"),$("#marca").val(e).trigger("change"),$("#tipo_medida").val(r).trigger("change"),$("#codigo").val(c),$("#presentacion").val(d),$("#modal-title").text("Actualizar producto"),$("#modal_action_button").text("Actualizar"),$("#modal_action_button").data("id",t),$("#modalSignin").modal("show");break;case"ver":$("#nombre").val(i),$("#nombre").prop("disabled",!0),$("#categoria").val(n).trigger("change"),$("#categoria").prop("disabled",!0),$("#marca").val(e).trigger("change"),$("#marca").prop("disabled",!0),$("#tipo_medida").val(r).trigger("change"),$("#tipo_medida").prop("disabled",!0),$("#codigo").val(c),$("#codigo").prop("disabled",!0),$("#presentacion").val(d),$("#presentacion").prop("disabled",!0),$("#modal-title").text("Ver producto"),$("#modal_action_button").hide(),$("#modalSignin").modal("show");break;case"eliminar":$("#modal_action_button").data("id",t),$("#modalSheet").modal("show")}})),$(document).on("click","#modal_action_button",(function(a){var o=$(this).text(),t=$("#modal_action_button").data("id");const i=document.querySelector(".needs-validation");switch(o){case"Crear":if(!i.checkValidity())return a.preventDefault(),a.stopPropagation(),void i.classList.add("was-validated");crear_producto();break;case"Actualizar":if(!i.checkValidity())return a.preventDefault(),a.stopPropagation(),void i.classList.add("was-validated");actualizar_producto(t);break;case"Eliminar":eliminar_producto(t)}})),$("#modalSignin").on("hidden.bs.modal",(function(){$("#nombre").prop("disabled",!1),$("#categoria").prop("disabled",!1),$("#marca").prop("disabled",!1),$("#tipo_medida").prop("disabled",!1),$("#codigo").prop("disabled",!1),$("#presentacion").prop("disabled",!1),$("#modal_action_button").show(),form.classList.remove("was-validated")}));